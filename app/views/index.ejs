<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Heartfelt</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body>
        <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
        <svg height="500"></svg>
        <div class='main-content'>

          <h4 id = "title">Heartfelt</h4>
          <%if(messages.length>0){%>
            <% message = messages[Math.floor(Math.random()*messages.length)] %>
            <%- `<a href=${message.link} id = "listen">Listen To A Message</button>` %>
          <%} else{%>
            <p id = "noMessages">No messages... yet</p>
          <%}%>
          <a href="/record" id = "recordLink">Record A Message</a>
        </div>

        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>
          var width = window.innerWidth;

          var svg = d3.select("svg"),
              angles = d3.range(0, 2* Math.PI, Math.PI / 400);

          svg.attr('width', width);
          var height = svg.attr('height');

          var path = svg.append("g")
              .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
              .attr("fill", "none")
              .attr("stroke-width", 10)
              .attr("stroke-linejoin", "round")
            .selectAll("path")
            .data(["rgb(161, 255, 255)", "rgb(255, 43, 255)", "rgb(255, 255, 47)"])
            .enter().append("path")
              .attr("stroke", function(d) { return d; })
              .style("mix-blend-mode", "darken")
              .datum(function(d, i) {
                return d3.radialLine()
                    .curve(d3.curveLinearClosed)
                    .angle(function(a) { return a; })
                    .radius(function(a) {
                      var t = d3.now() / 1000;
                      a += Math.PI/3
                      return 100 + Math.cos(a * 2 - i * Math.PI/9 + t) * Math.pow((1 + Math.cos(a - t)) / 2, 3) * 120;
                    });
              });

          d3.timer(function() {
            path.attr("d", function(d) {
              return d(angles);
            });
          });

        </script>
        <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
        <!-- <script>
            window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
            ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
        </script>
        <script src="https://www.google-analytics.com/analytics.js" async defer></script> -->
    </body>
</html>
